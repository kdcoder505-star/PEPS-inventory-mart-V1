<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PEPS Mart — Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    :root { --green:#28a745; --green-dark:#1e7e34; --gradient: linear-gradient(135deg,#28a745,#1e7e34); }
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#f8fdf8; }
    .navbar { background: var(--green-dark); }
    .navbar .nav-link, .navbar .navbar-brand { color: #fff !important; }
    .hero { background: var(--gradient); color:#fff; padding:1.25rem; border-radius:.6rem; margin:1rem 0; text-align:center; }
    .card { border-radius:.6rem; box-shadow:0 6px 18px rgba(0,0,0,.06); }
    .product-img { width:48px; height:48px; object-fit:cover; border-radius:6px; }
    footer { background:var(--green-dark); color:#fff; padding:1rem 0; text-align:center; margin-top:2rem; }
    /* small responsive tweaks */
    @media (max-width:575px) { .hero p { font-size: .95rem; } }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="#">PEPS Admin</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="nav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="#dashboard">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="#inventory">Inventory</a></li>
        <li class="nav-item"><a class="nav-link" href="#staff">Staff</a></li>
        <li class="nav-item"><a class="nav-link" href="#requests">Requests</a></li>
        <li class="nav-item"><a class="nav-link" href="#returns">Returns</a></li>
        <li class="nav-item"><a class="nav-link" href="#history">History</a></li>
        <li class="nav-item"><a class="nav-link" href="index.html" onclick="logout()">Logout</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container">
  <div class="hero">
    <h2>⚙️ Admin Dashboard</h2>
    <p>Manage products, staff, requests and returns. Admins have full control.</p>
  </div>

  <!-- Dashboard cards -->
  <div class="row g-3 mb-4" id="dashboard">
    <div class="col-6 col-md-3"><div class="card p-3 text-center" onclick="scrollTo('inventory')"><i class="fas fa-box fa-2x mb-2 text-success"></i><h4 id="totalProducts">0</h4><div class="text-muted">Products</div></div></div>
    <div class="col-6 col-md-3"><div class="card p-3 text-center" onclick="scrollTo('staff')"><i class="fas fa-users fa-2x mb-2 text-primary"></i><h4 id="totalStaff">0</h4><div class="text-muted">Staff</div></div></div>
    <div class="col-6 col-md-3"><div class="card p-3 text-center" onclick="scrollTo('requests')"><i class="fas fa-envelope fa-2x mb-2 text-info"></i><h4 id="pendingRequests">0</h4><div class="text-muted">Pending Requests</div></div></div>
    <div class="col-6 col-md-3"><div class="card p-3 text-center" onclick="scrollTo('returns')"><i class="fas fa-undo fa-2x mb-2 text-secondary"></i><h4 id="returnsCount">0</h4><div class="text-muted">Returns</div></div></div>
  </div>

  <!-- Inventory -->
  <div class="card p-3 mb-4" id="inventory">
    <div class="d-flex flex-wrap gap-2 justify-content-between align-items-center mb-2">
      <h5 class="mb-0">Inventory</h5>
      <div class="d-flex gap-2">
        <input id="searchInventory" class="form-control form-control-sm" placeholder="Search products...">
        <select id="filterCategory" class="form-select form-select-sm"><option value="">All Categories</option></select>
        <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#addProductModal"><i class="fas fa-plus"></i> Add Product</button>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead class="table-success">
          <tr><th>Image</th><th>Name</th><th>Category</th><th>Price</th><th>Stock</th><th style="min-width:140px">Action</th></tr>
        </thead>
        <tbody id="inventoryTable"></tbody>
      </table>
    </div>
  </div>

  <!-- Staff -->
  <div class="card p-3 mb-4" id="staff">
    <div class="d-flex flex-wrap gap-2 justify-content-between align-items-center mb-2">
      <h5 class="mb-0">Staff Management</h5>
      <div class="d-flex gap-2">
        <input id="searchStaff" class="form-control form-control-sm" placeholder="Search staff...">
        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addStaffModal"><i class="fas fa-user-plus"></i> Add Staff</button>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead class="table-primary"><tr><th>Name</th><th>Email</th><th>Role</th><th style="min-width:120px">Action</th></tr></thead>
        <tbody id="staffTable"></tbody>
      </table>
    </div>
  </div>

  <!-- Requests -->
  <div class="card p-3 mb-4" id="requests">
    <div class="d-flex flex-wrap gap-2 justify-content-between align-items-center mb-2">
      <h5 class="mb-0">Customer Requests</h5>
      <div class="d-flex gap-2">
        <input id="searchRequests" class="form-control form-control-sm" placeholder="Search requests...">
        <select id="filterRequestStatus" class="form-select form-select-sm">
          <option value="">All Status</option><option value="Pending">Pending</option><option value="Approved">Approved</option><option value="Completed">Completed</option>
        </select>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead class="table-success"><tr><th>Customer</th><th>Email</th><th>Items</th><th>Total</th><th>Status</th><th style="min-width:120px">Action</th></tr></thead>
        <tbody id="requestTable"></tbody>
      </table>
    </div>
  </div>

  <!-- Returns -->
  <div class="card p-3 mb-4" id="returns">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="mb-0">Returns</h5>
    </div>
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead class="table-success"><tr><th>Customer</th><th>Item</th><th>Date</th><th>Status</th><th style="min-width:120px">Action</th></tr></thead>
        <tbody id="returnTable"></tbody>
      </table>
    </div>
  </div>

  <!-- History -->
  <div class="card p-3 mb-4" id="history">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="mb-0">History</h5>
      <div class="d-flex gap-2">
        <button class="btn btn-sm btn-secondary" onclick="downloadHistory()"><i class="fas fa-download"></i> Download</button>
        <button class="btn btn-sm btn-danger" onclick="clearHistory()"><i class="fas fa-trash"></i> Clear All</button>
      </div>
    </div>
    <ul class="list-group" id="historyList"></ul>
  </div>
</div>

<!-- Admins -->
<div class="container">
<div class="card p-3 mb-4" id="admins">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h5 class="mb-0">Admins Management</h5>
    <div class="d-flex gap-2">
      <input id="searchAdmins" class="form-control form-control-sm" placeholder="Search admins...">
      <button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#addAdminModal">
        <i class="fas fa-user-shield"></i> Add Admin
      </button>
      <button class="btn btn-sm btn-secondary" onclick="downloadAdmins()">
        <i class="fas fa-download"></i> Download
      </button>
    </div>
  </div>
  <div class="table-responsive">
    <table class="table table-striped align-middle">
      <thead class="table-danger">
        <tr><th>Name</th><th>Email</th><th>Action</th></tr>
      </thead>
      <tbody id="adminTable"></tbody>
    </table>
  </div>
</div>

<!-- Add Admin Modal -->
<div class="modal fade" id="addAdminModal" tabindex="-1">
  <div class="modal-dialog"><div class="modal-content">
    <form id="addAdminForm">
      <div class="modal-header">
        <h5 class="modal-title">Add Admin</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input id="aname" class="form-control mb-2" placeholder="Name" required>
        <input id="aemail" class="form-control mb-2" placeholder="Email" required>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-danger">Add Admin</button>
      </div>
    </form>
  </div></div>
</div>
</div>

<footer><small>&copy; 2024 PEPS Mart</small></footer>

<!-- ---------------- Modals ---------------- -->

<!-- Add Product Modal -->
<div class="modal fade" id="addProductModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content">
  <form id="addProductForm">
    <div class="modal-header"><h5 class="modal-title">Add Product</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body">
      <input id="pname" class="form-control mb-2" placeholder="Product name" required>
      <div class="d-flex gap-2 mb-2">
        <select id="pcatSelect" class="form-select"><option value="">Select category</option></select>
        <input id="pcatNew" class="form-control" placeholder="Or new category">
      </div>
      <input id="pprice" type="number" class="form-control mb-2" placeholder="Price" required>
      <input id="pstock" type="number" class="form-control mb-2" placeholder="Stock" required>
      <input id="pimg" class="form-control mb-2" placeholder="Image URL (optional)">
    </div>
    <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button><button class="btn btn-success">Add Product</button></div>
  </form>
</div></div></div>

<!-- Edit Product Modal -->
<div class="modal fade" id="editProductModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content">
  <form id="editProductForm">
    <div class="modal-header"><h5 class="modal-title">Edit Product</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body">
      <input type="hidden" id="editIndex">
      <input id="editName" class="form-control mb-2" required>
      <div class="d-flex gap-2 mb-2">
        <select id="editCatSelect" class="form-select"></select>
        <input id="editCatNew" class="form-control" placeholder="Or new category">
      </div>
      <input id="editPrice" type="number" class="form-control mb-2" required>
      <input id="editStock" type="number" class="form-control mb-2" required>
      <input id="editImg" class="form-control mb-2" placeholder="Image URL (optional)">
    </div>
    <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button><button class="btn btn-success">Save Changes</button></div>
  </form>
</div></div></div>

<!-- Add Staff Modal -->
<div class="modal fade" id="addStaffModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content">
  <form id="addStaffForm">
    <div class="modal-header"><h5 class="modal-title">Add Staff</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body">
      <input id="sname" class="form-control mb-2" placeholder="Name" required>
      <input id="semail" class="form-control mb-2" placeholder="Email" required>
      <select id="srole" class="form-select mb-2"><option>Admin</option><option>Manager</option><option>Staff</option></select>
      <input id="spass" type="password" class="form-control mb-2" placeholder="Password" required>
    </div>
    <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button><button class="btn btn-primary">Add Staff</button></div>
  </form>
</div></div></div>

<!-- Request Modal -->
<div class="modal fade" id="requestModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content">
  <div class="modal-header"><h5 class="modal-title">Manage Request</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
  <div class="modal-body">
    <input type="hidden" id="reqIndex">
    <p><strong>Name:</strong> <span id="reqName"></span></p>
    <p><strong>Email:</strong> <span id="reqEmail"></span></p>
    <p><strong>Items:</strong> <span id="reqItems"></span></p>
    <p><strong>Total:</strong> <span id="reqTotal"></span></p>
    <p><strong>Status:</strong> <span id="reqStatus"></span></p>
  </div>
  <div class="modal-footer">
    <button id="approveBtn" class="btn btn-success">Approve</button>
    <button id="completeBtn" class="btn btn-secondary">Complete</button>
    <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
  </div>
</div></div></div>

<!-- Return Modal -->
<div class="modal fade" id="returnModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content">
  <form id="editReturnForm">
    <div class="modal-header"><h5 class="modal-title">Manage Return</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body">
      <input type="hidden" id="retIndex">
      <input id="editRName" class="form-control mb-2" required>
      <input id="editRItem" class="form-control mb-2" required>
      <p><strong>Date:</strong> <span id="editRDate"></span></p>
      <select id="editRStatus" class="form-select mb-2"><option>Pending</option><option>Processed</option></select>
    </div>
    <div class="modal-footer">
      <button id="deleteReturnBtn" type="button" class="btn btn-danger">Delete</button>
      <button class="btn btn-success">Save</button>
    </div>
  </form>
</div></div></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* ------------------ Utilities ------------------ */
function getData(k){ return JSON.parse(localStorage.getItem(k)) || []; }
function saveData(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
</script>

<script type="module">
  import { collection, getDocs, addDoc, updateDoc, deleteDoc, doc } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  async function getProducts(){
    const snap = await getDocs(collection(db, "products"));
    return snap.docs.map(d => ({ id: d.id, ...d.data() }));
  }

  async function addProduct(product){
    await addDoc(collection(db, "products"), product);
  }

  async function updateProduct(id, product){
    await updateDoc(doc(db, "products", id), product);
  }

  async function deleteProduct(id){
    await deleteDoc(doc(db, "products", id));
  }
</script>

<script type="module">
async function renderProducts(){
  const products = await getProducts();  // load from Firestore
  const tbody = document.getElementById("inventoryTable");
  tbody.innerHTML = "";

  products.forEach((p) => {
    tbody.insertAdjacentHTML("beforeend", `
      <tr>
        <td><img src="${p.img || 'https://placehold.co/50'}" class="product-img"></td>
        <td>${p.name}</td>
        <td>${p.cat}</td>
        <td>${p.price}</td>
        <td>${p.stock}</td>
        <td>
          <button class="btn btn-sm btn-danger" onclick="deleteProduct('${p.id}').then(renderProducts)">Delete</button>
        </td>
      </tr>
    `);
  });

  document.getElementById("totalProducts").textContent = products.length;
}

// run once on load
renderProducts();
</script>

<script type="module">
document.getElementById("addProductForm").addEventListener("submit", async function(e){
  e.preventDefault();

  const product = {
    name: document.getElementById("pname").value,
    cat: document.getElementById("pcatNew").value || document.getElementById("pcatSelect").value,
    price: Number(document.getElementById("pprice").value),
    stock: Number(document.getElementById("pstock").value),
    img: document.getElementById("pimg").value || "https://placehold.co/100x100"
  };

  await addProduct(product);   // save to Firestore
  this.reset();
  bootstrap.Modal.getInstance(document.getElementById("addProductModal")).hide();
  renderProducts();            // refresh table
});
</script>


<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyBMoZ1loJufX19C6AefXj4SWAiHEwj0Pek",
    authDomain: "peps-mart.firebaseapp.com",
    projectId: "peps-mart",
    storageBucket: "peps-mart.firebasestorage.app",
    messagingSenderId: "998682975624",
    appId: "1:998682975624:web:e2c3830c4dfb706cea6e3d",
    measurementId: "G-43VMGD4104"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);

  // expose Firestore globally


</script>
<script type="module">
  import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  async function testDB() {
    try {
      const snap = await getDocs(collection(db, "products"));
      console.log("Products:", snap.docs.map(d => d.data()));
    } catch (err) {
      console.error("Firestore error:", err);
    }
  }

  testDB();
</script>

</body>
</html>
